<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备维保 Demo 控制台</title>
    <link rel="stylesheet" href="demo.css">
</head>
<body>
    <header>
        <h1>设备维保 Demo 控制台</h1>
        <p>按照演示剧本串联报修、派工、执行、领料、验收与看板刷新。所有请求直接调用同源 API。</p>
    </header>

    <section id="auth-panel" class="card">
        <h2>1. 登录角色</h2>
        <form id="login-form" class="grid">
            <label>
                选择账号
                <select name="username" id="login-username">
                    <option value="dispatcher" data-password="dispatcher123">调度（dispatcher）</option>
                    <option value="tech" data-password="tech123">技师（tech）</option>
                    <option value="wh" data-password="wh123">库管（wh）</option>
                    <option value="viewer" data-password="viewer123">查看（viewer）</option>
                </select>
            </label>
            <label>
                密码
                <input type="password" name="password" id="login-password" value="dispatcher123" required>
            </label>
            <button type="submit">获取 Token</button>
        </form>
        <div id="token-state">
            <h3>已登录账号</h3>
            <ul id="token-list"></ul>
        </div>
    </section>

    <section class="card">
        <h2>2. 报修</h2>
        <form class="api-form" data-endpoint="/tickets" data-method="POST" data-role="dispatcher">
            <div class="grid">
                <label>设备ID<input type="number" name="asset_id" required></label>
                <label>故障描述<input type="text" name="symptom" required></label>
                <label>严重度<select name="severity" data-number="true" required>
                    <option value="1">1-低</option>
                    <option value="2">2-中</option>
                    <option value="3">3-高</option>
                </select></label>
                <label>照片URL（逗号分隔，可选）<input type="text" name="photos" data-array="csv"></label>
            </div>
            <button type="submit">创建报修</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/tickets" data-method="GET" data-role="dispatcher">
            <div class="grid">
                <label>状态筛选<select name="status">
                    <option value="">全部</option>
                    <option value="NEW">NEW</option>
                    <option value="WO_CREATED">WO_CREATED</option>
                </select></label>
            </div>
            <button type="submit">查看报修列表</button>
            <pre class="result"></pre>
        </form>
    </section>

    <section class="card">
        <h2>3. 工单派工与执行</h2>
        <form class="api-form" data-endpoint="/work-orders" data-method="POST" data-role="dispatcher">
            <div class="grid">
                <label>来源报修ID<input type="number" name="ticket_id" required></label>
            </div>
            <button type="submit">生成工单</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/work-orders/{id}/assign" data-method="POST" data-role="dispatcher">
            <div class="grid">
                <label>工单ID<input type="number" name="path_id" required></label>
                <label>技师ID<input type="number" name="assignee_id" required></label>
                <label>预计完成时间（可选）<input type="datetime-local" name="eta"></label>
            </div>
            <button type="submit">派工</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/work-orders/{id}/start" data-method="POST" data-role="tech">
            <div class="grid">
                <label>工单ID<input type="number" name="path_id" required></label>
            </div>
            <button type="submit">开始</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/work-orders/{id}/pause" data-method="POST" data-role="tech">
            <div class="grid">
                <label>工单ID<input type="number" name="path_id" required></label>
            </div>
            <button type="submit">暂停</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/work-orders/{id}/resume" data-method="POST" data-role="tech">
            <div class="grid">
                <label>工单ID<input type="number" name="path_id" required></label>
            </div>
            <button type="submit">继续</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/work-orders/{id}/complete" data-method="POST" data-role="tech">
            <div class="grid">
                <label>工单ID<input type="number" name="path_id" required></label>
                <label>处理措施<textarea name="tech_result" rows="2"></textarea></label>
                <label>本次工时（分钟）<input type="number" name="labor_minutes"></label>
                <label>完成备注<textarea name="remarks" rows="2"></textarea></label>
                <label>确认未使用材料？<input type="checkbox" name="materials_confirmed"></label>
            </div>
            <button type="submit">完工提交</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/work-orders/{id}/acceptance" data-method="POST" data-role="viewer">
            <div class="grid">
                <label>工单ID<input type="number" name="path_id" required></label>
                <label>是否通过<select name="passed" data-boolean="true" required>
                    <option value="true">通过</option>
                    <option value="false">不通过</option>
                </select></label>
                <label>评分（0-100）<input type="number" name="score" min="0" max="100"></label>
                <label>验收备注<textarea name="remarks" rows="2"></textarea></label>
                <label>验收照片（逗号分隔）<input type="text" name="photos" data-array="csv"></label>
            </div>
            <button type="submit">提交验收</button>
            <pre class="result"></pre>
        </form>
    </section>

    <section class="card">
        <h2>4. 备件与库存</h2>
        <form class="api-form" data-endpoint="/spares" data-method="GET" data-role="wh">
            <div class="grid">
                <label>关键字<input type="text" name="keyword"></label>
            </div>
            <button type="submit">查询备件</button>
            <pre class="result"></pre>
        </form>
        <form class="api-form" data-endpoint="/inventory/transactions" data-method="POST" data-role="wh">
            <div class="grid">
                <label>工单ID<input type="number" name="work_order_id" required></label>
                <label>备件ID<input type="number" name="spare_id" required></label>
                <label>数量<input type="number" name="qty" required></label>
                <label>类型<select name="type" required>
                    <option value="issue">领料 issue</option>
                    <option value="return">退料 return</option>
                </select></label>
            </div>
            <button type="submit">提交库存事务</button>
            <pre class="result"></pre>
        </form>
    </section>

    <section class="card">
        <h2>5. 看板</h2>
        <form class="api-form" data-endpoint="/reports/dashboard" data-method="GET" data-role="dispatcher">
            <button type="submit">刷新 Dashboard</button>
            <pre class="result"></pre>
        </form>
    </section>

    <section class="card">
        <h2>6. 附件上传（选填）</h2>
        <form class="api-form" data-endpoint="/attachments" data-method="POST" data-role="dispatcher">
            <div class="grid">
                <label>主体类型<input type="text" name="owner_type" placeholder="ticket 或 work_order" required></label>
                <label>主体ID<input type="number" name="owner_id" required></label>
                <label>文件名<input type="text" name="filename" required></label>
                <label>内容（自动 base64）<textarea name="content_text" rows="2" placeholder="粘贴原文或留空上传示例"></textarea></label>
            </div>
            <button type="submit">上传附件</button>
            <pre class="result"></pre>
        </form>
    </section>

    <section class="card">
        <h2>7. 调试日志</h2>
        <pre id="global-log"></pre>
    </section>

    <script src="demo.js"></script>
</body>
</html>
